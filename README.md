# Google Custom Search API 検索ツール（GUI版）

Google Custom Search APIを使用して指定されたキーワードの検索結果1位の情報を取得し、CSV形式で出力するWindowsアプリケーションです。

実行ファイル（.exe）形式で提供され、Pythonのインストールは不要です。PyQt6を使用した直感的なグラフィカルユーザーインターフェースで、誰でも簡単に検索操作が行えます。

## 📋 機能概要

- **キーワード検索**: Google Custom Search APIを使用した高速検索
- **結果取得**: 検索結果1位のタイトル、URL、スニペットを取得
- **CSV出力**: UTF-8 BOM付きのCSV形式でファイル出力
- **複数入力方式**: 手動入力、ファイル読み込みに対応
- **直感的なGUI**: PyQt6による使いやすいグラフィカルインターフェース
- **高性能Virtual Table**: 大量データ（10,000行以上）の高速表示・フィルタリング
- **リアルタイム進捗表示**: 検索進捗をプログレスバーで表示
- **設定管理**: GUI上でAPI設定を簡単に管理
- **結果表示**: Virtual Table による高速検索結果表示とリアルタイムフィルタリング
- **ログ表示**: 実行ログをリアルタイムで確認
- **ファイル操作**: ドラッグ&ドロップやファイルダイアログでの簡単操作
- **エラーハンドリング**: リトライ処理、タイムアウト処理

## 🚀 セットアップ手順

### 実行ファイル（.exe）版（推奨）

1. **実行ファイルをダウンロード**
   - リリースページから最新の`GoogleSearchTool.exe`をダウンロード
   - 任意のフォルダに配置

2. **アプリケーション起動**
   - `GoogleSearchTool.exe`をダブルクリックで起動
   - Python環境不要で、そのまま実行可能

3. **API設定**
   - 初回起動時、「設定」タブでAPI設定を行う
   - 設定は自動的に保存される

### 実行ファイルの作成方法（開発者向け）

ソースコードから実行ファイルを作成する場合：

1. **環境準備**
   ```powershell
   # リポジトリのクローン
   git clone <repository-url>
   cd Google-Search-Tool-GUI-PRO

   # 依存ライブラリのインストール
   pip install -r requirements.txt
   ```

2. **実行ファイル作成**
   ```powershell
   # EXEファイルの作成
   python build_exe.py
   ```

3. **出力場所**
   - 作成されたファイル: `build/GoogleSearchTool/GoogleSearchTool.exe`
   - 配布時は`build/GoogleSearchTool/`フォルダ全体をコピー

## 🔧 Google Custom Search API の設定

### 1. Google Cloud Console での設定

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクトを作成または選択
3. Custom Search JSON API を有効化
4. APIキーを作成

### 2. カスタム検索エンジンの作成

1. [Programmable Search Engine](https://programmablesearchengine.google.com/) にアクセス
2. 新しい検索エンジンを作成
3. 「ウェブ全体を検索」を選択
4. 検索エンジンIDを取得

詳細な手順は「設定」タブの「ヘルプ」ボタンから確認できます。

## 📖 使用方法

### 🖥️ アプリケーション起動

**`GoogleSearchTool.exe` をダブルクリック**して起動します。

### ✨ GUI の特徴
- **直感的な操作**: マウスとキーボードで簡単操作
- **リアルタイム進捗**: 検索進捗をプログレスバーで表示
- **設定管理**: GUI上でAPI設定を管理
- **結果表示**: 検索結果をテーブル形式で表示
- **ログ表示**: 実行ログをリアルタイムで確認
- **ファイル操作**: ドラッグ&ドロップやファイルダイアログでの簡単操作

### 📋 使用手順
1. **起動**: `GoogleSearchTool.exe` をダブルクリック
2. **設定**: 「設定」タブでAPI KeyとSearch Engine IDを入力
3. **接続テスト**: 「API接続テスト」ボタンで設定確認
4. **キーワード入力**: 
   - **手動入力**: 「検索」タブでキーワードを1つずつ追加
   - **ファイル読み込み**: 「ファイルから読み込み」ボタンでテキストファイルを選択
5. **検索実行**: 「検索開始」ボタンをクリック
6. **結果確認**: 「結果」タブで検索結果を確認
7. **保存**: 「CSV形式で保存」ボタンで結果をエクスポート

### ⚙️ 検索設定
GUI内で以下の設定が可能です：
- **検索間隔**: 検索クエリ間の待機時間（デフォルト: 1.0秒）
- **リトライ回数**: 検索失敗時の再試行回数（デフォルト: 3回）
- **タイムアウト時間**: 検索タイムアウト時間（デフォルト: 10秒）
- **検索結果取得件数**: 各キーワードで取得する検索結果の件数（デフォルト: 1件、最大: 10件）

## 🚀 高性能Virtual Table機能

本アプリケーションでは、大量の検索結果を効率的に表示・操作するための**Virtual Table**機能を実装しています。

### ✨ Virtual Table機能の特徴

#### 🏃‍♂️ 高速パフォーマンス
- **大量データ対応**: 10,000行以上のデータを高速表示（978,697行/秒のスループット）
- **仮想化技術**: 必要な行のみを描画するため、メモリ使用量を大幅削減
- **リアルタイム処理**: フィルタリング、ソート処理を高速実行

#### 🔍 高機能フィルタリング
- **リアルタイム検索**: 入力と同時に結果をフィルタリング
- **複数フィールド対応**: キーワード、タイトル、URL、スニペットを横断検索
- **大文字小文字無視**: 柔軟な検索でユーザビリティを向上

#### 📊 直感的な操作
- **列ソート**: ヘッダークリックで昇順・降順ソート
- **行選択**: クリックで詳細情報表示
- **ページネーション**: 大量データを適切なページサイズで分割表示（オプション）

#### 📈 パフォーマンス監視
- **リアルタイム統計**: データ操作、フィルタリング、描画のパフォーマンス監視
- **メモリ使用量追跡**: 効率的なメモリ使用状況を可視化
- **ベンチマーク機能**: システムパフォーマンスの継続的な測定

### 🛠️ Virtual Table技術詳細

#### アーキテクチャ
- **VirtualTableModel**: QAbstractTableModelベースの高効率データモデル
- **FilterableVirtualTableModel**: リアルタイムフィルタリング機能
- **VirtualTableWidget**: 統合UI コンポーネント
- **VirtualTablePerformanceMonitor**: パフォーマンス監視システム

#### 最適化技術
- **遅延描画**: 表示領域の行のみ描画
- **フィルタ最適化**: 300ms遅延実行で快適なタイピング体験
- **メモリ効率**: 大量データでも低メモリフットプリント
- **キャッシュシステム**: 頻繁にアクセスされるデータの高速取得

## 📂 出力ファイル形式

### CSVファイル構造

```csv
検索キーワード,タイトル,URL,スニペット,検索日時
Python プログラミング,Python.org,https://www.python.org/,Python is a programming language...,2025-06-09 14:30:15
```

### ファイル命名規則

```
search_results_YYYYMMDD_HHMMSS.csv
```

例: `search_results_20250609_143015.csv`

## 📁 プロジェクト構造

### ユーザー向け（実行ファイル版）
```
GoogleSearchTool.exe         # メイン実行ファイル
README.md                    # 使用方法の説明
config/
└── config.json             # 設定ファイル（自動作成）
logs/
└── search.log              # 実行ログ（自動作成）
output/
└── search_results_*.csv    # 検索結果CSV（自動作成）
```

### 開発者向け（ソースコード版）
```
Google-Search-Tool-GUI-PRO/
├── GoogleSearchTool.exe     # 実行ファイル（build後に作成）
├── README.md                # このファイル
├── requirements.txt         # 依存ライブラリ（開発者向け）
├── keywords_sample.txt      # サンプルキーワードファイル
├── build_exe.py             # 実行ファイル作成スクリプト（開発者向け）
├── main.py                  # アプリケーション起動スクリプト（開発者向け）
├── CHANGELOG.md             # 変更履歴
├── version_info.txt         # バージョン情報
├── config/
│   ├── config_sample.json   # 設定ファイルサンプル
│   └── config.json          # 実際の設定ファイル（自動作成）
├── src/                     # ソースコード（開発者向け）
├── logs/                    # ログファイル（自動作成）
├── output/                  # 出力ファイル（自動作成）
└── dist/                    # 実行ファイル配布用（build後に作成）
    ├── GoogleSearchTool.exe
    └── README.md
```

## ⚙️ 設定項目

### GUI設定

GUIアプリケーション内で以下の設定が可能です：

#### API設定（必須）
- **Google API Key**: Google Cloud Consoleで取得したAPIキー
- **Search Engine ID**: カスタム検索エンジンID

#### 検索設定
- **検索間隔**: 検索クエリ間の待機時間（デフォルト: 1.0秒）
- **リトライ回数**: 検索失敗時の再試行回数（デフォルト: 3回）
- **タイムアウト時間**: 検索タイムアウト時間（デフォルト: 10秒）
- **検索結果取得件数**: 各キーワードで取得する検索結果の件数（デフォルト: 1件、最大: 10件）

#### 出力設定
- **出力ディレクトリ**: 結果ファイルの保存先（デフォルト: output）
- **ファイル名プレフィックス**: 出力ファイル名の接頭辞（デフォルト: search_results）

### 設定ファイル（config.json）

設定はGUIで変更可能ですが、直接ファイルを編集することも可能です：

```json
{
  "google_api": {
    "api_key": "your_api_key",
    "custom_search_engine_id": "your_search_engine_id"
  },
  "output": {
    "directory": "output",
    "filename_prefix": "search_results"
  },
  "search": {
    "retry_count": 3,
    "retry_delay": 1.0,
    "timeout": 10,
    "num": 1
  }
}
```

## 🔍 キーワードファイル形式

キーワードファイルは以下の形式で作成してください:

```text
# コメント行（#または//で開始）
Python プログラミング
機械学習 入門
データサイエンス

// 空行は無視されます
ウェブスクレイピング
```

- 1行につき1つのキーワード
- `#` または `//` で始まる行はコメント行として無視
- 空行は無視
- UTF-8エンコーディング推奨

## 📊 ログ表示

### GUIでのログ表示
- アプリケーション下部のログエリアにリアルタイムでログが表示されます
- ログレベル別に色分けされて表示されます：
  - **INFO**: 通常の情報（黒色）
  - **WARNING**: 警告メッセージ（オレンジ色）
  - **ERROR**: エラーメッセージ（赤色）

### ログファイル
- ファイル保存場所: `logs/search.log`
- 検索実行の詳細な履歴が保存されます
- 問題発生時のトラブルシューティングに使用できます

## ⚠️ 注意事項・制限事項

### API制限

- **無料プラン**: 1日100クエリまで
- **レート制限**: 100クエリ/100秒
- 制限を超過した場合はエラーが発生します

### 推奨事項

- キーワード間に1秒以上の間隔を設定（`--delay` オプション）
- 大量検索時は有料プランの利用を検討
- APIキーの機密性を保持（`.gitignore`で除外済み）

### エラー対応

- ネットワークエラー時は自動リトライ（最大3回）
- API制限エラー時は処理を停止
- 途中終了時（Ctrl+C）は処理済み結果を保存

## 🛠️ トラブルシューティング

### よくある問題と解決方法

#### 1. APIキー設定エラー
**症状**: 「API接続テスト」で失敗する
**解決方法**: 
1. 「設定」タブでAPIキーを再確認
2. Google Cloud ConsoleでAPIキーが有効か確認
3. Custom Search JSON APIが有効化されているか確認

#### 2. 検索エンジンID設定エラー
**症状**: 検索実行時にエラーが発生する
**解決方法**:
1. 「設定」タブで検索エンジンIDを再確認
2. Programmable Search Engineでエンジンが正しく設定されているか確認

#### 3. API制限エラー
**症状**: 「API制限に達しました」というエラーメッセージ
**解決方法**:
1. 検索間隔を長くする（2秒以上推奨）
2. 翌日まで待機する
3. 有料プランへのアップグレードを検討

#### 4. ファイル読み込みエラー
**症状**: キーワードファイルが読み込めない
**解決方法**:
1. ファイルがUTF-8エンコーディングで保存されているか確認
2. ファイルパスに日本語や特殊文字が含まれていないか確認
3. ファイルの読み取り権限があるか確認

#### 5. アプリケーションが起動しない
**症状**: `GoogleSearchTool.exe` をダブルクリックしても起動しない

**解決方法**:
1. ウイルス対策ソフトによるブロックを確認
2. Windows Defenderの除外設定を確認
3. 管理者権限で実行してみる
4. 実行ファイルと同じフォルダに必要なファイルがあるか確認

### ログとエラー確認方法
- **GUIログ**: アプリケーション下部のログエリアを確認
- **ログファイル**: `logs/search.log` を確認

詳細な情報は以下のログファイルを確認してください:

```bash
tail -f logs/search.log
```

## 🧪 アプリケーションのテスト

### 基本動作確認

1. **アプリケーション起動**
   ```
   GoogleSearchTool.exe をダブルクリックして起動
   ```

2. **設定確認**
   - GUI起動後、「設定」タブを開く
   - API KeyとSearch Engine IDを入力
   - 「API接続テスト」ボタンをクリックして接続確認

3. **検索機能テスト**
   - 「検索」タブでキーワード「test」を追加
   - 「検索開始」ボタンをクリック
   - 「結果」タブで結果を確認

4. **ファイル読み込みテスト**
   - 「検索」タブで「ファイルから読み込み」ボタンをクリック
   - `keywords_sample.txt` を選択
   - キーワードが正常に読み込まれることを確認

## 🤝 開発・カスタマイズ

### 開発環境のセットアップ（開発者向け）

```powershell
# テスト実行
python -m pytest tests/

# コード品質チェック
flake8 src/

# 実行ファイル作成
python build_exe.py
```

### プロジェクト構成の詳細（開発者向け）

- `main.py`: アプリケーション起動エントリーポイント
- `src/gui_main.py`: メインGUIインターフェース
- `src/config_manager.py`: 設定管理システム
- `src/google_search_api.py`: Google API接続処理
- `src/search_engine.py`: 検索エンジン本体
- `src/csv_writer.py`: CSV出力処理
- `config/`: 設定ファイル管理
- `logs/`: 実行ログ（自動生成）
- `output/`: 検索結果CSV（自動生成）
- `build/`: 実行ファイル（自動生成）

### カスタマイズポイント（開発者向け）

- **UI改善**: `src/gui_main.py` でインターフェースをカスタマイズ
- **検索設定**: `src/search_engine.py` で検索ロジックを調整
- **出力形式**: `src/csv_writer.py` で出力フォーマットを変更

## 📋 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

問題が発生した場合は、以下の手順で対処してください:

1. **GUI内のログを確認**: アプリケーション下部のログエリア
2. **このREADMEのトラブルシューティングを参照**
3. **ログファイルを確認**: `logs/search.log` の内容
4. **設定を再確認**: 「設定」タブでAPI設定を確認
5. **API接続テストを実行**: 「API接続テスト」ボタンで接続確認

### よくある質問

**Q: アプリケーションが起動しない**
A: ウイルス対策ソフトのブロックを確認し、管理者権限で実行してください

**Q: 検索結果が取得できない**
A: 「設定」タブで「API接続テスト」を実行し、設定を確認してください

**Q: 実行ファイルはどこで入手できますか**
A: リリースページから最新の`GoogleSearchTool.exe`をダウンロードしてください

**Q: 設定が保存されない**
A: アプリケーションに書き込み権限があるか確認してください